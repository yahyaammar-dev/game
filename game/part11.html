<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.16.2/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>

    <script type="text/javascript">

        var config = {
            type: Phaser.AUTO,
            width: 900,
            height: 800,
            scene: {
                extends: {
                    displayQuestion,
                    checkAnswer
                },
                preload: preload,
                create: create,
                update: update
            }
        };

        var game = new Phaser.Game(config);

        var tree;
        var cloud, cloud1
        var treeTween;
        var bg, text;
        var checkbox
        var checkboxLabel
        var questions; // Array to store questions and options
        var currentQuestionIndex = 0; // Index of the current question
        var questionText;
        var optionLabels = [];
        var lifeLines = []
        var hurrayTween;
        function preload() {
            this.load.image("tree", "assets/tree-large.png");
            this.load.image("sky", "assets/sky.png");
            this.load.image("cloud", "assets/cloud-01.png");
            this.load.image("heart", "assets/heart.png");
            this.load.json('questions', 'data/qa.json');
            this.load.image("bg", "assets/bg.png")
            this.load.image("train", "assets/train.png")
            this.load.image("tre", "assets/tree.png")
        }

        function create() {
            bg = this.add.image(0, 0, 'bg');
            tree = this.add.image(650, 700, 'tre');
            cloud = this.add.image(100, 100, 'cloud');
            cloud1 = this.add.image(700, 200, 'cloud');

            bg.setOrigin(0, 0);

            // Scale the image to cover the full frame
            bg.setScale(game.config.width / bg.width, game.config.height / bg.height);

            cloud.displayWidth = 200;
            cloud.displayHeight = 300

            cloud1.displayWidth = 200;
            cloud1.displayHeight = 300

            tree.displayWidth = 400;
            tree.displayHeight = 800;
            tree.rotation = Phaser.Math.DegToRad(-5);

            //  for (var j = 0; j < question.options.length; j++) {
            //     var life = 
            //     optionLabel.setOrigin(0.5);
            //     optionLabel.setInteractive();
            //     optionLabel.on('pointerdown', checkAnswer.bind(scene, scene, question, j));
            //     optionLabel.on('pointerover', function () {
            //         optionLabel.setTint(0xff0000);
            //         document.body.style.cursor = 'pointer';
            //     });
            //     optionLabels.push(optionLabel);
            // }

            this.tweens.add({
                targets: tree,
                rotation: Phaser.Math.DegToRad(5),
                duration: 3000,
                ease: 'Sine.easeInOut',
                yoyo: true,
                repeat: -1
            });


            treeTween = this.tweens.add({
                targets: cloud,
                x: 400,
                duration: 5000,
                ease: 'Sine.easeInOut',
                yoyo: true,
                repeat: -1
            });
            treeTween = this.tweens.add({
                targets: cloud1,
                x: 500,
                duration: 5000,
                ease: 'Sine.easeInOut',
                yoyo: true,
                repeat: -1
            });



            var questionsBackground = this.add.rectangle(400, 370, 580, 250, 0x6666ff, 0.9);
            // questionsBackground.setRadius(20)


            questions = this.cache.json.get('questions'); // Get questions from JSON file
            displayQuestion(this, currentQuestionIndex)

        }


        function update() {

        }

        function displayQuestion(scene, index) {

            var question = questions[index];
            if (questionText) {
                questionText.destroy();
            }
            for (var i = 0; i < optionLabels.length; i++) {
                optionLabels[i].destroy();
            }
            optionLabels = [];
            questionText = scene.add.text(400, 300, question.question, { fontFamily: 'Georgia', fontSize: '28px', fill: '#000000' });
            questionText.setOrigin(0.5);



            for (var j = 0; j < question.options.length; j++) {
                var optionContainer = scene.add.container(240, 340 + j * 50);

                var padding = 10;

                var optionLabel = scene.add.text(padding, padding, question.options[j], { fontFamily: 'Georgia', fontSize: '24px', fill: '#000000' });
                optionLabel.setOrigin(0, 0);
                optionLabel.setInteractive();

                var background = scene.add.rectangle(0, 0, optionLabel.width + 2 * padding, optionLabel.height + 2 * padding, 0xb5ffc9);
                background.setOrigin(0, 0);
                background.setVisible(false);

                optionContainer.add([background, optionLabel]);

                optionContainer.x -= padding;
                optionContainer.y -= padding;

                optionLabel.on('pointerdown', checkAnswer.bind(scene, scene, question, j, optionLabel));

                (function (label, bg) {
                    label.on('pointerover', function () {
                        bg.setVisible(true);
                        label.setTint(0xff0000);
                        document.body.style.cursor = 'pointer';
                    });

                    label.on('pointerout', function () {
                        bg.setVisible(false);
                        label.clearTint();
                        document.body.style.cursor = 'default';
                    });
                })(optionLabel, background);

                optionLabels.push(optionContainer);
            }
        }


        function playHurrayAnimation(scene, optionLabel) {
            if (hurrayTween && hurrayTween.isPlaying()) {
                hurrayTween.stop();
            }

            // Adjust properties and duration based on your preferences
            hurrayTween = scene.tweens.add({
                targets: optionLabel,
                scaleX: 1.5,
                scaleY: 1.5,
                alpha: 0,
                duration: 1000,
                ease: 'Power2',
                onComplete: function () {
                    // Reset properties after the animation is complete
                    questionText.setScale(1);
                    questionText.setAlpha(1);
                    currentQuestionIndex++;
                    displayQuestion(scene, currentQuestionIndex)
                }
            });
        }



        function checkAnswer(scene, question, selectedOptionIndex, optionLabel) {
            if (selectedOptionIndex === question.correctOptionIndex) {
                console.log('Correct!');
                playHurrayAnimation(scene, optionLabel)
            } else {

                console.log('Incorrect!');
            }
        }
    
    
    </script>

</body>

</html>